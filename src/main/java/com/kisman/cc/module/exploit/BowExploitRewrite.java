package com.kisman.cc.module.exploit;

import com.kisman.cc.module.Category;
import com.kisman.cc.module.Module;
import com.kisman.cc.settings.Setting;
import i.gishreloaded.gishcode.utils.visual.ChatUtils;
import net.minecraft.item.ItemBow;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;

public class BowExploitRewrite extends Module {
    private Setting dmg = new Setting("Dmg", this, 100, 150, 10, true);
    private Setting debug = new Setting("Debug", this, true);
    private Setting test = new Setting("Test", this, false);

    public BowExploitRewrite() {
        super("BowExploitRewrite", Category.EXPLOIT);

        setmgr.rSetting(dmg);
        setmgr.rSetting(debug);
        setmgr.rSetting(test);
    }

    public void update() {
        if(mc.player == null && mc.world == null) return;

        if(mc.player.getHeldItemMainhand().getItem() instanceof ItemBow) {
            if(mc.player.getItemInUseMaxCount() > 0 && test.getValBoolean()) mc.player.rotationPitch = 0;
            if(mc.player.getItemInUseMaxCount() > 10) {
                mc.player.connection.sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SNEAKING));
                mc.player.connection.sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SPRINTING));
                mc.player.connection.sendPacket(new CPacketEntityAction(mc.player, CPacketEntityAction.Action.START_SNEAKING));
                for (int index = 0; index < dmg.getValInt(); ++index) {
                    mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY - 1e-10, mc.player.posZ, true));
                    mc.player.connection.sendPacket(new CPacketPlayer.Position(mc.player.posX, mc.player.posY + 1e-10, mc.player.posZ, false));
                }

                if (debug.getValBoolean()) ChatUtils.complete("Spoofed");
                mc.gameSettings.keyBindUseItem.pressed = false;
            }
        }
    }
}
